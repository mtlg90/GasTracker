<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gas Tracker</title>
  <!-- Favicon / icona per iPhone -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon.png">
  <link rel="apple-touch-icon" href="icon.png">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 600px; }
    h1 { text-align: center; }
    label { display: block; margin-top: 10px; }
    input { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
    button { margin-top: 10px; padding: 10px; width: 100%; font-size: 16px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    @media (max-width: 500px) {
      button { font-size: 14px; padding: 8px; }
      input { padding: 6px; }
    }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    // Configurazione Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCdY2xuLVTBmwUbs-sud5g6W-7eedoI1Qk",
      authDomain: "gastracker-a4bc5.firebaseapp.com",
      databaseURL: "https://gastracker-a4bc5-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gastracker-a4bc5",
      storageBucket: "gastracker-a4bc5.firebasestorage.app",
      messagingSenderId: "523976617358",
      appId: "1:523976617358:web:1494df462f40813ec548df"
    };
    // Inizializza Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Funzione per salvare lettura
    function saveReading() {
      const date = document.getElementById('date').value;
      const reading = document.getElementById('reading').value;
      const temp = document.getElementById('temp').value;
      if (!date || !reading || !temp) {
        alert("Compila tutti i campi!");
        return;
      }
      database.ref('readings/' + date).set({
        reading: reading,
        temperature: temp,
        timestamp: Date.now()
      }, (error) => {
        if (error) alert("Errore salvataggio: " + error);
        else {
          alert("Lettura salvata online!");
          loadReadings();
        }
      });
    }

    // Funzione per caricare letture
    function loadReadings() {
      database.ref('readings').once('value', snapshot => {
        const readings = snapshot.val();
        const tbody = document.getElementById('readingsBody');
        tbody.innerHTML = '';
        if (!readings) return;
        Object.keys(readings).sort().forEach(date => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${date}</td><td>${readings[date].reading}</td><td>${readings[date].temperature}</td>`;
          tbody.appendChild(tr);
        });
      });
    }

    // Funzione per cancellare tutte le letture
    function clearAllReadings() {
      if (confirm("Vuoi davvero cancellare tutte le letture?")) {
        database.ref('readings').remove()
          .then(() => {
            alert("Dati cancellati");
            loadReadings();
          })
          .catch(err => alert("Errore: " + err));
      }
    }

    // Carica le letture all'avvio
    window.onload = loadReadings;
  </script>
</head>
<body>
  <h1>Gas Tracker</h1>
  <label>Data:
    <input type="date" id="date">
  </label>
  <label>Lettura Smc:
    <input type="number" id="reading" step="0.01">
  </label>
  <label>Temperatura minima esterna (°C):
    <input type="number" id="temp" step="0.1">
  </label>
  <button onclick="saveReading()">Salva Lettura</button>
  <button onclick="clearAllReadings()" style="background-color: #f44336; color:white;">Cancella Tutto</button>

  <table>
    <thead>
      <tr>
        <th>Data</th>
        <th>Lettura (Smc)</th>
        <th>Temperatura (°C)</th>
      </tr>
    </thead>
    <tbody id="readingsBody"></tbody>
  </table>
</body>
</html>